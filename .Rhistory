Country.name.vec <- toupper(c('Cuba','Dominican Republic','Jamaica','Puerto Rico',
'Trinidad and Tobago','Costa Rica','El Salvador','Guatemala',
'Honduras','Mexico','Nicaragua','Panama','Argentina',
'Chile','Colombia','Ecuador','Paraguay','Peru','Uruguay','Venezuela',
'Haiti','Bolivia','Brazil', 'Latin America'))
# Create a vector with the countries' codes according to WHO
Country.code.vec <- c(2150,2170,2290,2380,2440,2140,2190,2250,2280,2310,
2340,2350,2020,2120,2130,2180,2360,2370,2460,2470,2270,2060,2070,9999)
names(Country.code.vec) <- Country.name.vec
Country.code.vec
Country.name.vec <- toupper(c('Cuba','Dominican Republic','Jamaica','Puerto Rico',
'Trinidad and Tobago','Costa Rica','El Salvador','Guatemala',
'Honduras','Mexico','Nicaragua','Panama','Argentina',
'Chile','Colombia','Ecuador','Paraguay','Peru','Uruguay','Venezuela',
'Haiti','Bolivia','Brazil', 'Latin America'))
# Create a vector with the countries' codes according to WHO
Country.code.vec <- c(2150,2170,2290,2380,2440,2140,2190,2250,2280,2310,
2340,2350,2020,2120,2130,2180,2360,2370,2460,2470,2270,2060,2070,9999)
names(Country.code.vec) <- Country.name.vec
Country.code.vec
# Create a vector with the countries we are interested in
Country.name.vec <- toupper(c('Cuba','Dominican Republic','Jamaica','Puerto Rico',
'Trinidad and Tobago','Costa Rica','El Salvador','Guatemala',
'Honduras','Mexico','Nicaragua','Panama','Argentina',
'Chile','Colombia','Ecuador','Paraguay','Peru','Uruguay','Venezuela',
'Haiti','Bolivia','Brazil', 'Latin America'))
# Create a vector with the countries' codes according to WHO
Country.code.vec <- c(2150,2170,2290,2380,2440,2140,2190,2250,2280,2310,
2340,2350,2020,2120,2130,2180,2360,2370,2460,2470,2270,2060,2070,9999)
names(Country.code.vec) <- Country.name.vec
Country.code.vec
# Create a vector with the countries we are interested in
Country.name.vec <- toupper(c('Cuba','Dominican Republic','Jamaica','Puerto Rico',
'Trinidad and Tobago','Costa Rica','El Salvador','Guatemala',
'Honduras','Mexico','Nicaragua','Panama','Argentina',
'Chile','Colombia','Ecuador','Paraguay','Peru','Uruguay','Venezuela',
'Haiti','Bolivia','Brazil', 'Latin America'))
# Create a vector with the countries' codes according to WHO
Country.code.vec <- c(2150,2170,2290,2380,2440,2140,2190,2250,2280,2310,
2340,2350,2020,2120,2130,2180,2360,2370,2460,2470,2270,2060,2070,9999)
names(Country.code.vec) <- Country.name.vec
Country.code.vec
qpois(p = .5,lambda = .7)
sidebarPanel
library(shiny)
library(data.table)
library(DT)
names.c <- toupper(c('Dominican Republic', 'Costa Rica','El Salvador', 'Guatemala','Mexico', 'Nicaragua',
'Argentina', 'Chile', 'Colombia', 'Ecuador', 'Paraguay',
'Peru', 'Uruguay', 'Venezuela', 'Brazil', 'Cuba','Honduras','Panama','Jamaica'))
Sources <- c('CEPAL2004','CEPAL2010','UN')
Periods <- c("1990-1995", "1995-2000" ,"2000-2005" ,"2005-2010")
sidebarPanel
load('Decomp_results.RData')
setwd("C:/Users/jmaburto/Documents/GitHub/CoD-burden-on-LA/R/Decomp2_App/")
library(shiny)
library(ggplot2)
#rsconnect::setAccountInfo(name='jmaburto',
#                          token='7310E08D0D081D3C3CABCAA90D18045E',
#                          secret='Vzlie6RN39/THGhWKatGf/C68yZp+RENdTdOl/ey')
rsconnect::setAccountInfo(name='wb-lac',
token='06E52479A00F914E6EE44A17FFEA7E80',
secret='D7wg0N0miuHwY8reIRkCRy38E+TSCGXy+nHgm+KH')
load('Decomp_results.RData')
library(ggplot2)
library(data.table)
load('Decomp_results.RData')
setwd("C:/Users/jmaburto/Documents/GitHub/CoD-burden-on-LA/R/Decomp2_App/")
exit
library(plotly)
shiny::runApp('GitHub/CoD-burden-on-LA/R/ex_App')
runApp('GitHub/CoD-burden-on-LA/R/ex_App')
runApp('GitHub/CoD-burden-on-LA/R/ex_App')
runApp('GitHub/CoD-burden-on-LA/R/ex_App')
runApp('GitHub/CoD-burden-on-LA/R/ex_App')
devtools::install_github("mpascariu/MortalityLaws")
devtools::install_github("mpascariu/MortalityLaws")
library(MortalityLaws)
availableHMD()
getwd()
exp(0.068)
exp(.08)
log(.5)
log(1)
log(0)
citation
citation()
cite()
?cite
citation()
shiny::runApp('GitHub/Lifespan-variation-in-Eastern-Europe-2017/R/Sensitivity Analysis/CEE_App')
install.packages('HMDHFDplus') #package by Tim Riffe
library(HMDHFDplus)
XYZ <- 'DNK
XYZ <- 'DNK'
XYZ <- 'DNK'
XYZ
us <- "jmaburto@colmex.mx"
pw <- "kolmogorov"
deaths <- readHMDweb(XYZ,"mltper_1x1",username=us,password=pw)
deaths <- readHMDweb(XYZ,"Deaths1x1",username=us,password=pw)
library(ggplot2)
library(data.table)
#load the data
load('VenezuelaData.Rdata')
#load some functions and some info for graphs
source('Functions_4.R')
e0.frommx
Decomp
# first we need to vectors of mortality rates
mx1 <- COD[COD$year == 1996,]$mx
mx2 <- COD[COD$year == 2013,]$mx
Results
#Now we can perfom the decomposition
Results <- Decomp(func = e0.frommx, rates1 = mx1, rates2 = mx2, N = 50)
Results
#original
original <- e0.frommx(mx2) - e0.frommx(mx1)
original
with.decomp
#with decomp
with.decomp <- sum(Results)
original
with.decomp
with.decomp - original
original
with.decomp
#error
with.decomp - original
#now graph results
ggplot()+
ggtitle(bquote(~'Change in '~ e[0] ~'1996-2013' ))+
geom_bar(aes(x = age_names, y= Results), stat = "identity", position = "stack")
#now graph results
ggplot()+
ggtitle(bquote(~'Change in '~ e[0] ~'1996-2013' ))+
geom_bar(aes(x = age_names, y= Results), stat = "identity", position = "stack")
#now graph results
ggplot()+
ggtitle(bquote(~'Change in '~ e[0] ~'1996-2013' ))+
geom_bar(aes(x = age_names, y= Results), stat = "identity", position = "stack")
#now graph results
ggplot()+
ggtitle(bquote(~'Change in '~ e[0] ~'1996-2013' ))+
geom_bar(aes(x = age_names, y= Results), stat = "identity", position = "stack")
#now graph results
ggplot()+
ggtitle(bquote(~'Change in '~ e[0] ~'1996-2013' ))+
geom_bar(aes(x = age_names, y= Results), stat = "identity", position = "stack")
library(ggplot2)
library(data.table)
#load the data
load('VenezuelaData.Rdata')
#we need age-cause specific mortality rates in each period
COD1        <- as.matrix(COD[COD$year==1996,5:14]*COD[COD$year == 1996,]$mx)
COD2        <- as.matrix(COD[COD$year==2013,5:14]*COD[COD$year == 2013,]$mx)
#load some functions and some info for graphs
source('Functions_4.R')
#load some functions and some info for graphs
source('Functions_5.R')
e0frommxc <- function(mxcvec,sex=1){
dim(mxcvec) <- c(19,length(mxcvec)/19)
mx          <- rowSums(mxcvec)
e0.frommx(mx,sex)
}
e0frommxc <- function(mxcvec,sex=1){
dim(mxcvec) <- c(19,length(mxcvec)/19)
mx          <- rowSums(mxcvec)
e0.frommx(mx,sex)
}
Results <- Decomp(func = e0frommxc, rates1 = c(COD1), rates2 = c(COD2), N = 50)
Results <- Decomp(func = e0frommxc, rates1 = c(COD1), rates2 = c(COD2), N = 50)
#Go back to a matrix
dim(Results) <- dim(COD1)
Results
Results <- Decomp(func = e0frommxc, rates1 = c(COD1), rates2 = c(COD2), N = 50)
Results
#Go back to a matrix
dim(Results) <- dim(COD1)
Results
#original
original <- e0.frommx(mx2) - e0.frommx(mx1)
#with decomp
with.decomp <- sum(Results)
original
with.decomp
#error
with.decomp - original
#Now we can perfom the decomposition
Results <- Decomp(func = e0frommxc, rates1 = c(COD1), rates2 = c(COD2), N = 50)
Results
Results      <- data.table(Results)
#Now we can perfom the decomposition
Results <- Decomp(func = e0frommxc, rates1 = c(COD1), rates2 = c(COD2), N = 50)
Results
#Go back to a matrix
dim(Results) <- dim(COD1)
Results
colnames(Results) <- cause_names
View(Results)
Results$year      <- '1996-2013'
Results          <- data.frame(Results)
#Now we can perfom the decomposition
Results <- Decomp(func = e0frommxc, rates1 = c(COD1), rates2 = c(COD2), N = 50)
Results
#Go back to a matrix
dim(Results) <- dim(COD1)
Results
#original
original <- e0.frommx(mx2) - e0.frommx(mx1)
#with decomp
with.decomp <- sum(Results)
original
with.decomp
#error
with.decomp - original
Results          <- data.frame(Results)
View(Results)
colnames(Results) <- cause_names
Results$year      <- '1996-2013'
Results$Year      <- '1996-2013'
Results$Age       <- c(0,1,seq(5,85,5))
rownames(Results)  <- age_names
View(Results)
library(tidyr)
gather(data = Results,key = c(Year,Age),value = Contribution)
x <- gather(data = Results,key = c(Year,Age),value = Contribution)
View(x)
gather(data = Results,key = c(Year,Age),value = Contribution)
y <- melt.data.table(decomp,id.vars = c('Year','Age'),variable.name = 'Cause',value.name = 'Contribution')
y <- melt.data.table(Results,id.vars = c('Year','Age'),variable.name = 'Cause',value.name = 'Contribution')
y <- data.table(Results)
y2 <- data.table(Results)
y <- melt.data.table(y2,id.vars = c('Year','Age'),variable.name = 'Cause',value.name = 'Contribution')
#Now we can perfom the decomposition
Results <- Decomp(func = e0frommxc, rates1 = c(COD1), rates2 = c(COD2), N = 50)
Results
#Go back to a matrix
dim(Results) <- dim(COD1)
Results
Results            <- data.frame(Results)
colnames(Results)  <- cause_names
Results$Age        <- c(0,1,seq(5,85,5))
rownames(Results)  <- age_names
x <- gather(data = Results,key = Age,value = Contribution, -Age)
View(x)
y2 <- data.table(Results)
y <- melt.data.table(y2,id.vars = c('Year','Age'),variable.name = 'Cause',value.name = 'Contribution')
y <- melt.data.table(y2,id.vars = c('Age'),variable.name = 'Cause',value.name = 'Contribution')
x <- gather(data = Results,key = Age,value = Contribution, -Contribution)
x <- gather(data = Results,key = Age,value = Contribution, -Age)
x <- gather(data = Results,key = Age,value = Contribution, -Cause)
y2 <- data.table(Results)
y <- melt.data.table(y2,id.vars = c('Year','Age'),variable.name = 'Cause',value.name = 'Contribution')
y <- melt.data.table(y2,id.vars = c('Age'),variable.name = 'Cause',value.name = 'Contribution')
y
x <- gather(data = Results,key = c(Age),value = Contribution)
x <- gather(data = Results,key = c(Age),value = Contribution,-Cause)
x <- gather(data = Results,key = c(Age),value = Contribution,-Age)
x <- gather(data = Results,key = Cause,value = Contribution,-Age)
x
Results            <- gather(data = Results,key = Cause,value = Contribution,-Age)
ggplot(data=Results, aes(x=as.factor(Age), y=Contribution, fill=Cause))+
ggtitle(bquote(~'Change in '~ e[0] ~'1996-2013' ))+
#scale_fill_manual(name= ' Cause of death (Contribution)',values=base2,labels = cause.lab.male)+
geom_bar(stat = "identity", position = "stack",color="black", size=0.5)
ggplot(data=Results, aes(x=as.factor(Age), y=Contribution, fill=Cause))+
ggtitle(bquote(~'Change in '~ e[0] ~'1996-2013' ))+
geom_bar(stat = "identity", position = "stack")
Results            <- data.frame(Results)
colnames(Results)  <- cause_names
library(ggplot2)
library(tidyr)
#load the data
load('VenezuelaData.Rdata')
#we need age-cause specific mortality rates in each period
COD1        <- as.matrix(COD[COD$year==1996,5:14]*COD[COD$year == 1996,]$mx)
COD2        <- as.matrix(COD[COD$year==2013,5:14]*COD[COD$year == 2013,]$mx)
#load some functions and some info for graphs
source('Functions_5.R')
e0frommxc <- function(mxcvec,sex=1){
dim(mxcvec) <- c(19,length(mxcvec)/19)
mx          <- rowSums(mxcvec)
e0.frommx(mx,sex)
}
#Now we can perfom the decomposition
Results <- Decomp(func = e0frommxc, rates1 = c(COD1), rates2 = c(COD2), N = 50)
Results
#Go back to a matrix
dim(Results) <- dim(COD1)
Results
#original
original <- e0.frommx(mx2) - e0.frommx(mx1)
#with decomp
with.decomp <- sum(Results)
#original
original <- e0frommxc(COD2) - e0frommxc(COD1)
#with decomp
with.decomp <- sum(Results)
original
with.decomp
#error
with.decomp - original
Results            <- data.frame(Results)
colnames(Results)  <- cause_names
Results$Age        <- c(0,1,seq(5,85,5))
rownames(Results)  <- age_names
Results            <- gather(data = Results,key = Cause,value = Contribution,-Age)
#now graph results
ggplot(data=Results, aes(x=as.factor(Age), y=Contribution, fill=Cause))+
ggtitle(bquote(~'Change in '~ e[0] ~'1996-2013' ))+
geom_bar(stat = "identity", position = "stack")
#rm(list=ls(all=TRUE))
library(data.table)
library(reshape2)
library(ggplot2)
setwd("C:/Users/jmaburto/Documents/GitHub/Lifespan-inequality-Denmark")
HMD <- get(load('Data/HMD_Data.RData'))
## subset the countries that I am interested in
unique(HMD$PopName)
Countries <- c('DNK', 'SWE')
Data <- HMD[HMD$PopName %in% Countries,]
#gdata::keep(Data,Countries,sure=T)
source('R/Sensitivity Analysis/Functions_Sensitivity.R')
#get the standard deviation
Data <- data.table(Data)
Data$Sex2 <- Data$Sex
Data <- Data[, sd:= sd.frommx(.SD$mx,.SD$Sex2[1]), by = list(Year,Sex,PopName)]
Data <- Data[Data$Age == 0,]
Data <- Data[Data$Year >= 1960,]
head(Data)
Data[Data$Sex2 == 'f',]$Sex2 <- 'Females'
Data[Data$Sex2 == 'm',]$Sex2 <- 'Males'
q <-ggplot(Data, aes(x = Year,y = sd)) +
ggtitle('Trends in standard deviation') +
geom_rect(aes(xmin=1975, xmax=1995, ymin=-Inf, ymax=Inf),
fill = "pink", alpha = 0.01, show.legend = F) +
geom_line(aes(group = PopName,colour=PopName), size= 1.2,show.legend = F) +
scale_x_continuous(breaks = c(1960, 1975, 1995,2005,2014))+
facet_wrap(~Sex2)+
theme_light()+
labs(y = "Years")+
scale_colour_manual('Country', values = c('red','green'), labels = c('Denmark', 'Sweden')) +
theme(text = element_text(size=14),
strip.text.x = element_text(size = 14, colour = "black"))
q
pdf(file="R/Sensitivity Analysis/Figures Sensitivity/Trends_SD.pdf",width=9,height=5,pointsize=4,useDingbats = F)
q
dev.off()
pdf(file="R/Sensitivity Analysis/Figures Sensitivity/Trends_SD.pdf",width=9,height=5,pointsize=4,useDingbats = F)
q
dev.off()
load("C:/Users/jmabu/OneDrive - Nexus365/GitHub/Lifespan-inequality-Denmark/Data/COD_Data.RData")
load("C:/Users/jmabu/OneDrive - Nexus365/GitHub/Lifespan-inequality-Denmark/Data/DT_COD.RData")
View(DT_COD.melt)
library(ggplot2)
library(data.table)
library(reshape2)
#load data
HMD       <- get(load('Data/HMD_Data.RData'))
Countries <- c('DNK', 'SWE', 'NOR')
Data      <- HMD[HMD$PopName %in% Countries,]
Data$Country.name <- Data$PopName
Data      <- Data[,c(1,12,14,2,3)]
Data      <- Data[Data$Year >= 1960 & Data$Year <= 2014,]
gdata::keep(Data,Countries,sure=T)
COD       <- local(get(load('Data/Single_COD.RData')))
COD       <- COD[COD$Year >= 1960 & COD$Year <= 2014,]
COD$Sex   <- as.character(COD$Sex)
levels(COD$Country.name) <- Countries
COD$Country.name         <- as.character(COD$Country.name)
#get proportions by age
COD  <- COD[, Dx.p:= Dx/sum(Dx), by= list(Country, Country.name, ICD, Year, Sex,Age)]
COD[is.na(Dx.p),]$Dx.p <- 0
COD       <- COD[,c(4,5,2,6,8,9)]
COD.cast <- dcast(COD,Year+Sex+Country.name+Age ~ Cat,value.var = 'Dx.p')
#Merge datsets
mx.COD        <- merge(COD,Data,by = c('Year','Sex','Country.name','Age'), all = T)
mx.COD$mx.COD <- mx.COD$Dx.p * mx.COD$mx
mx.COD        <- mx.COD[order(Country.name, Year, Sex, Cat, Age),]
mx.COD.cast   <- dcast.data.table(mx.COD, Year+Sex+Country.name+Age ~ Cat, value.var = 'mx.COD')
mx.COD.cast
names(mx.COD.cast)
names(mx.COD.cast)[4:11]
paste0('Cause',2:9)
names(mx.COD.cast)[4:11] <- paste0('Cause_',2:9)
mx.COD.cast
names(mx.COD.cast)[4:11] <- paste0('Cause_',1:8)
mx.COD.cast
mx.COD.cast[,Total.mx := Cause_1+Cause_2+Cause_3+Cause_4+Cause_5+Cause_6+Cause_7+Cause_8]
mx.COD.cast
save(mx.COD.cast,file = 'Data/Hampton_examle.RData')
unique(mx.COD.cast$Country.name)
names(mx.COD.cast)[4:11]
#load data
HMD       <- get(load('Data/HMD_Data.RData'))
Countries <- c('DNK', 'SWE', 'NOR')
Data      <- HMD[HMD$PopName %in% Countries,]
Data$Country.name <- Data$PopName
Data      <- Data[,c(1,12,14,2,3)]
Data      <- Data[Data$Year >= 1960 & Data$Year <= 2014,]
gdata::keep(Data,Countries,sure=T)
COD       <- local(get(load('Data/Single_COD.RData')))
COD       <- COD[COD$Year >= 1960 & COD$Year <= 2014,]
COD$Sex   <- as.character(COD$Sex)
levels(COD$Country.name) <- Countries
COD$Country.name         <- as.character(COD$Country.name)
#get proportions by age
COD  <- COD[, Dx.p:= Dx/sum(Dx), by= list(Country, Country.name, ICD, Year, Sex,Age)]
COD[is.na(Dx.p),]$Dx.p <- 0
COD       <- COD[,c(4,5,2,6,8,9)]
COD.cast <- dcast(COD,Year+Sex+Country.name+Age ~ Cat,value.var = 'Dx.p')
#Merge datsets
mx.COD        <- merge(COD,Data,by = c('Year','Sex','Country.name','Age'), all = T)
mx.COD$mx.COD <- mx.COD$Dx.p * mx.COD$mx
mx.COD        <- mx.COD[order(Country.name, Year, Sex, Cat, Age),]
mx.COD.cast   <- dcast.data.table(mx.COD, Year+Sex+Country.name+Age ~ Cat, value.var = 'mx.COD')
names(mx.COD.cast)[5:11] <- paste0('Cause_',1:7)
mx.COD.cast
mx.COD.cast[,Total.mx := Cause_1+Cause_2+Cause_3+Cause_4+Cause_5+Cause_6+Cause_7]
unique(mx.COD.cast$Country.name)
save(mx.COD.cast,file = 'Data/Hampton_examle.RData')
save(mx.COD.cast,file = 'Data/Hampton_example.RData')
mx.COD.cast
mx.COD.cast
